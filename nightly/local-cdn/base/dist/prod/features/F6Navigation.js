"use strict";import{getFeature as p,registerFeature as m}from"../FeaturesRegistry.js";import{isF6Next as d,isF6Previous as c}from"../Keys.js";import{instanceOfUI5Element as h}from"../UI5Element.js";import{getFirstFocusableElement as f}from"../util/FocusableElements.js";import g from"../util/getFastNavigationGroups.js";import E from"../util/isElementClickable.js";import{getCurrentRuntimeIndex as w,compareRuntimes as v}from"../Runtimes.js";import y from"../getSharedResource.js";const l=w(),F=u=>u===void 0?!0:v(l,u)===1;class i{constructor(){this.selectedGroup=null;this.groups=[];this.keydownHandler=this._keydownHandler.bind(this),this.attachEventListeners()}attachEventListeners(){document.addEventListener("keydown",this.keydownHandler)}removeEventListeners(){document.removeEventListener("keydown",this.keydownHandler)}async groupElementToFocus(e){let t=e;if(h(e)&&(t=e.getDomRef()||e.firstElementChild),t){if(E(t))return t;const o=await f(t);if(o)return o}}async findNextFocusableGroupElement(e){let t;for(let o=0;o<this.groups.length;o++){let s;if(e>-1?e+1>=this.groups.length?(e=0,s=this.groups[e]):(e+=1,s=this.groups[e]):(e=0,s=this.groups[e]),t=await this.groupElementToFocus(s),t)break}return t}async findPreviousFocusableGroupElement(e){let t;for(let o=0;o<this.groups.length;o++){let s;if(e>0?(e=await this.groupElementToFocus(this.groups[e-1])===await this.groupElementToFocus(this.groups[e])?e-2:e-1,e<0&&(e=this.groups.length-1),s=this.groups[e]):(e=this.groups.length-1,s=this.groups[e]),t=await this.groupElementToFocus(s),t)break}return t}async _keydownHandler(e){const t=p("OpenUI5Support");if(t&&t.isOpenUI5Detected()){this.destroy();return}const s=d(e),r=c(e);if(!(s||r)||(this.updateGroups(),this.groups.length<1))return;e.preventDefault();let n;if(this.groups.length===0)return n=await this.groupElementToFocus(this.groups[0]),n?.focus();let a=-1;this.selectedGroup&&(a=this.groups.indexOf(this.selectedGroup)),s&&(n=await this.findNextFocusableGroupElement(a)),r&&(n=await this.findPreviousFocusableGroupElement(a)),n?.focus()}updateGroups(){const e=this.findContainer();this.setSelectedGroup(),this.groups=g(e)}findContainer(){const e=window.document.querySelector("html");let t=this.deepActive(window.document);for(;t&&t!==e;){const o=t.closest("[data-sap-ui-fastnavgroup-container='true']");if(o)return o;t=t.parentElement?t.parentElement:t.parentNode.host}return document.body}setSelectedGroup(e=window.document){const t=window.document.querySelector("html");let o=this.deepActive(e);for(;o&&o.getAttribute("data-sap-ui-fastnavgroup")!=="true"&&o!==t;)o=o.parentElement?o.parentNode:o.parentNode.host;this.selectedGroup=o}deepActive(e){return e?.activeElement?.shadowRoot?.activeElement?this.deepActive(e.activeElement.shadowRoot):e.activeElement}destroy(){this.removeEventListeners()}get _ui5RuntimeIndex(){return l}static init(){const e=y("F6Registry",{});e.instance?F(e.instance?._ui5RuntimeIndex)&&(e.instance?.destroy(),e.instance=new i):e.instance=new i}}m("F6Navigation",i);export default i;
//# sourceMappingURL=F6Navigation.js.map
